# å¼€æ”¾ API å¹³å° (API Platform)

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªå®Œæ•´çš„ã€ç”Ÿäº§çº§çš„å¼€æ”¾ API å¹³å°è§£å†³æ–¹æ¡ˆï¼Œé‡‡ç”¨ **å¤– HTTP å†… RPC** çš„æ··åˆå¾®æœåŠ¡æ¶æ„ã€‚å¹³å°æä¾›äº†ä»ç”¨æˆ·è®¤è¯ã€API ç½‘å…³ã€æ¥å£ç®¡ç†åˆ°å®¢æˆ·ç«¯ SDK çš„å…¨é“¾è·¯åŠŸèƒ½ï¼Œæ”¯æŒå¼€å‘è€…æ³¨å†Œã€è·å–å‡­è¯ï¼Œå¹¶é€šè¿‡ç»Ÿä¸€ç½‘å…³å®‰å…¨ã€ç¨³å®šåœ°è°ƒç”¨å¹³å° APIã€‚

## ğŸ¯ æ ¸å¿ƒæŠ€æœ¯äº®ç‚¹

### å¤– HTTP å†… RPC æ··åˆæ¶æ„

- **å¤–éƒ¨æ¥å£**: Spring Cloud Gateway æä¾›æ ‡å‡† HTTP APIï¼Œä¾¿äºå®¢æˆ·ç«¯é›†æˆ
- **å†…éƒ¨é€šä¿¡**: Dubbo RPC å®ç°é«˜æ€§èƒ½æœåŠ¡é—´è°ƒç”¨ï¼Œæ¯” HTTP å¿« 3-5 å€
- **æœåŠ¡æ²»ç†**: Nacos æ³¨å†Œä¸­å¿ƒç»Ÿä¸€ç®¡ç†æœåŠ¡å‘ç°å’Œé…ç½®

### å¤šçº§ç¼“å­˜æ¶æ„

- **L1 ç¼“å­˜**: Caffeine æœ¬åœ°ç¼“å­˜ï¼Œå¾®ç§’çº§è®¿é—®ï¼Œå‘½ä¸­ç‡ 85%+
- **L2 ç¼“å­˜**: Redis åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ¯«ç§’çº§è®¿é—®
- **æ™ºèƒ½é™çº§**: ç¼“å­˜å¤±è´¥è‡ªåŠ¨é™çº§åˆ°æ•°æ®åº“æŸ¥è¯¢ï¼Œä¿è¯å¯ç”¨æ€§

### å…­å±‚å®‰å…¨æ ¡éªŒæœºåˆ¶

- **å®Œæ•´é“¾è·¯**: IP ç™½åå• â†’ ç”¨æˆ·éªŒè¯ â†’ æ—¶é—´æˆ³æ ¡éªŒ â†’ ç­¾åéªŒè¯ â†’ æ¥å£æƒé™ â†’ è°ƒç”¨æ¬¡æ•°
- **é˜²æŠ¤èƒ½åŠ›**: é˜²é‡æ”¾æ”»å‡»ã€é˜²åˆ·æ¥å£ã€ç»†ç²’åº¦æƒé™æ§åˆ¶
- **ç›‘æ§å‘Šè­¦**: æ¯å±‚æ ¡éªŒéƒ½æœ‰å¯¹åº”çš„é”™è¯¯ç å’Œè¯¦ç»†æ—¥å¿—è®°å½•

## ğŸ—ï¸ ç³»ç»Ÿæ¶æ„

### å¾®æœåŠ¡æ¶æ„è®¾è®¡

å¹³å°é‡‡ç”¨å‰åç«¯åˆ†ç¦»çš„å¾®æœåŠ¡æ¶æ„ï¼Œæ ¸å¿ƒç‰¹ç‚¹æ˜¯ **å¤– HTTP å†… RPC** çš„æ··åˆé€šä¿¡æ¨¡å¼ï¼š

- **å¤–éƒ¨æ¥å£**: ç»Ÿä¸€é€šè¿‡ Spring Cloud Gateway æš´éœ² HTTP API
- **å†…éƒ¨é€šä¿¡**: å¾®æœåŠ¡é—´ä½¿ç”¨ Dubbo RPC é«˜æ€§èƒ½é€šä¿¡
- **æœåŠ¡æ²»ç†**: Nacos æä¾›æœåŠ¡æ³¨å†Œå‘ç°å’Œé…ç½®ç®¡ç†

**å¾®æœåŠ¡æ¶æ„å…¨æ™¯å›¾:**

```mermaid
graph TD
    subgraph Client["å®¢æˆ·ç«¯"]
        User[å¼€å‘è€…] --> SDK[api-sdk]
        SDK --> Gateway
    end

    subgraph APIGateway["APIç½‘å…³ (api-gateway)"]
        Gateway[Spring Cloud Gateway]
        Filter[å…¨å±€é‰´æƒè¿‡æ»¤å™¨]
        RateLimiter[Sentinelé™æµ/ç†”æ–­]
    end

    subgraph Backend["æ ¸å¿ƒåå° (backend)"]
        DubboProvider["DubboæœåŠ¡æä¾›è€…<br/>(InnerUserService, etc.)"]
        DB[(MySQLæ•°æ®åº“)]
    end

    subgraph BusinessService["ä¸šåŠ¡æœåŠ¡"]
        Interface["ä¸šåŠ¡APIå®ç°<br/>(api-interface)"]
    end

    subgraph Infrastructure["åŸºç¡€è®¾æ–½"]
        Nacos[Nacosæ³¨å†Œä¸é…ç½®ä¸­å¿ƒ]
        Redis["Redis - å¤šçº§ç¼“å­˜L2å±‚"]
        Caffeine["Caffeine - å¤šçº§ç¼“å­˜L1å±‚"]
    end

    Gateway --> Filter
    Filter --> DubboProvider
    DubboProvider --> DB
    Filter --> Interface

    Gateway -.-> RateLimiter
    Gateway -.-> Nacos
    DubboProvider -.-> Nacos
    Interface -.-> Nacos
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### åç«¯æŠ€æœ¯æ ˆ

| åˆ†ç±»           | æŠ€æœ¯                 | ç‰ˆæœ¬   | æè¿°                                         |
| :------------- | :------------------- | :----- | :------------------------------------------- |
| **æ ¸å¿ƒæ¡†æ¶**   | Spring Boot          | 3.2.3  | ä¼ä¸šçº§ Java åº”ç”¨å¼€å‘æ¡†æ¶                     |
| **Java ç‰ˆæœ¬**  | OpenJDK              | 17     | é•¿æœŸæ”¯æŒç‰ˆæœ¬ï¼Œæ€§èƒ½ä¼˜å¼‚                       |
| **API ç½‘å…³**   | Spring Cloud Gateway | 4.1.0  | å“åº”å¼ç½‘å…³ï¼Œæ”¯æŒåŠ¨æ€è·¯ç”±å’Œè¿‡æ»¤å™¨             |
| **å¾®æœåŠ¡æ¡†æ¶** | Apache Dubbo         | 3.3.0 | é«˜æ€§èƒ½ RPC æ¡†æ¶ï¼ŒæœåŠ¡é—´é€šä¿¡æ¯” HTTP å¿« 3-5 å€ |
| **æ³¨å†Œä¸­å¿ƒ**   | Nacos                | 2.3.0 | æœåŠ¡æ³¨å†Œå‘ç°ä¸é…ç½®ç®¡ç†                       |
| **å¤šçº§ç¼“å­˜**   | Caffeine + Redis     | -      | L1 æœ¬åœ°ç¼“å­˜ + L2 åˆ†å¸ƒå¼ç¼“å­˜ï¼Œæ˜¾è‘—æå‡æ€§èƒ½    |
| **æ•°æ®åº“**     | MySQL + MyBatis-Plus | 8.0+   | å…³ç³»å‹æ•°æ®åº“ä¸å¢å¼ºç‰ˆ ORM æ¡†æ¶                |
| **å®‰å…¨æ¡†æ¶**   | Spring Security      | 6.2.1  | ä¼ä¸šçº§å®‰å…¨è®¤è¯å’Œæˆæƒ                         |
| **API æ–‡æ¡£**   | Knife4j              | 4.4.0  | å¢å¼ºç‰ˆ Swaggerï¼Œè‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£            |
| **å·¥å…·åº“**     | Hutool               | 5.8.25 | Java å·¥å…·ç±»åº“ï¼Œæä¾›ä¸°å¯Œçš„å·¥å…·æ–¹æ³•             |
| **å¯¹è±¡å­˜å‚¨**   | Aliyun OSS           | 3.17.1 | é˜¿é‡Œäº‘å¯¹è±¡å­˜å‚¨æœåŠ¡                           |
| **å®¢æˆ·ç«¯ SDK** | è‡ªç ” SDK             | -      | å°è£…ç­¾åé€»è¾‘ï¼Œç®€åŒ– API è°ƒç”¨                  |

### å‰ç«¯æŠ€æœ¯æ ˆ

| åˆ†ç±»            | æŠ€æœ¯           | ç‰ˆæœ¬  | æè¿°                       |
| :-------------- | :------------- | :---- | :------------------------- |
| **å‰ç«¯æ¡†æ¶**    | Vue            | 3.5.17 | æ¸è¿›å¼ JavaScript æ¡†æ¶     |
| **UI ç»„ä»¶åº“**   | Ant Design Vue | 4.2.6  | ä¼ä¸šçº§ UI è®¾è®¡è¯­è¨€å’Œç»„ä»¶åº“ |
| **æ„å»ºå·¥å…·**    | Vite           | 5.3.5  | ä¸‹ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·         |
| **çŠ¶æ€ç®¡ç†**    | Pinia          | 3.0.3  | Vue 3 å®˜æ–¹æ¨èçŠ¶æ€ç®¡ç†åº“   |
| **HTTP å®¢æˆ·ç«¯** | Axios          | 1.10.0 | Promise based HTTP client  |
| **è·¯ç”±ç®¡ç†**    | Vue Router     | 4.5.1  | Vue.js å®˜æ–¹è·¯ç”±ç®¡ç†å™¨      |

## ğŸ“ é¡¹ç›®ç»“æ„

```java
API platform/
    â”œâ”€â”€ backend/                           # æ ¸å¿ƒç®¡ç†åå°
    â”‚   â”œâ”€â”€ src/main/java/com/zyb/backend/
    â”‚   â”‚   â”œâ”€â”€ controller/                # REST APIæ§åˆ¶å™¨
    â”‚   â”‚   â”œâ”€â”€ service/                   # ä¸šåŠ¡æœåŠ¡å±‚
    â”‚   â”‚   â”‚   â””â”€â”€ impl/                  # æœåŠ¡å®ç°
    â”‚   â”‚   â”œâ”€â”€ model/                     # æ•°æ®æ¨¡å‹
    â”‚   â”‚   â”‚   â”œâ”€â”€ entity/                # å®ä½“ç±»
    â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                   # æ•°æ®ä¼ è¾“å¯¹è±¡
    â”‚   â”‚   â”‚   â””â”€â”€ vo/                    # è§†å›¾å¯¹è±¡
    â”‚   â”‚   â”œâ”€â”€ mapper/                    # MyBatisæ•°æ®è®¿é—®å±‚
    â”‚   â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»
    â”‚   â”‚   â”œâ”€â”€ provider/                  # DubboæœåŠ¡æä¾›è€…
    â”‚   â”‚   â”œâ”€â”€ common/                    # é€šç”¨ç»„ä»¶
    â”‚   â”‚   â”œâ”€â”€ utils/                     # å·¥å…·ç±»
    â”‚   â”‚   â”œâ”€â”€ exception/                 # å¼‚å¸¸å¤„ç†
    â”‚   â”‚   â”œâ”€â”€ aop/                       # åˆ‡é¢ç¼–ç¨‹
    â”‚   â”‚   â”œâ”€â”€ annotation/                # è‡ªå®šä¹‰æ³¨è§£
    â”‚   â”‚   â”œâ”€â”€ constant/                  # å¸¸é‡å®šä¹‰
    â”‚   â”‚   â””â”€â”€ manager/                   # ç®¡ç†å™¨å±‚
    â”‚   â”œâ”€â”€ sql/                           # æ•°æ®åº“è„šæœ¬
    â”‚   â”‚   â”œâ”€â”€ create_table.sql           # å»ºè¡¨è„šæœ¬
    â”‚   â”œâ”€â”€ api-gateway/                   # APIç½‘å…³æœåŠ¡
    â”‚   â”‚   â”œâ”€â”€ src/main/java/com/zyb/backend/
    â”‚   â”‚   â”‚   â”œâ”€â”€ filter/                # ç½‘å…³è¿‡æ»¤å™¨
    â”‚   â”‚   â”‚   â”œâ”€â”€ config/                # ç½‘å…³é…ç½®
    â”‚   â”‚   â”‚   â””â”€â”€ service/               # ç½‘å…³æœåŠ¡
    â”‚   â”‚   â””â”€â”€ application.yml            # ç½‘å…³é…ç½®æ–‡ä»¶
    â”‚   â”œâ”€â”€ api-interface/                 # ç¤ºä¾‹APIæœåŠ¡
    â”‚   â”‚   â”œâ”€â”€ src/main/java/com/zyb/apiinterface/
    â”‚   â”‚   â”‚   â”œâ”€â”€ controller/            # APIæ§åˆ¶å™¨
    â”‚   â”‚   â”‚   â””â”€â”€ model/                 # æ•°æ®æ¨¡å‹
    â”‚   â”‚   â””â”€â”€ application.yml
    â”‚   â”œâ”€â”€ api-sdk/                       # å®¢æˆ·ç«¯SDK
    â”‚   â”‚   â””â”€â”€ src/main/java/com/zyb/apisdk/
    â”‚   â”‚       â”œâ”€â”€ client/                # APIå®¢æˆ·ç«¯
    â”‚   â”‚       â”œâ”€â”€ model/                 # è¯·æ±‚/å“åº”æ¨¡å‹
    â”‚   â”‚       â””â”€â”€ utils/                 # å·¥å…·ç±»
    â”‚   â””â”€â”€ api-common/                    # é€šç”¨æ¨¡å—
    â”‚       â””â”€â”€ src/main/java/com/zyb/apicommon/
    â”‚           â”œâ”€â”€ model/                 # é€šç”¨æ•°æ®æ¨¡å‹
    â”‚           â”œâ”€â”€ service/               # é€šç”¨æœåŠ¡æ¥å£
    â”‚           â””â”€â”€ utils/                 # é€šç”¨å·¥å…·ç±»
    â””â”€â”€ frontend/                          # å‰ç«¯ç®¡ç†ç•Œé¢
        â”œâ”€â”€ src/
        â”‚   â”œâ”€â”€ pages/                     # é¡µé¢ç»„ä»¶
        â”‚   â”œâ”€â”€ components/                # é€šç”¨ç»„ä»¶
        â”‚   â”œâ”€â”€ services/                  # APIæœåŠ¡
        â”‚   â””â”€â”€ utils/                     # å·¥å…·å‡½æ•°
        â”œâ”€â”€ config/                        # æ„å»ºé…ç½®
        â””â”€â”€ package.json
```

## ğŸ”§ æ¨¡å—è¯¦ç»†è¯´æ˜

### æ ¸å¿ƒæ¨¡å—

#### 1. **backend** (æ ¸å¿ƒç®¡ç†åå°)

- **åŠŸèƒ½**: æä¾› Web ç®¡ç†ç•Œé¢å’Œ Dubbo RPC æœåŠ¡
- **èŒè´£**: ç”¨æˆ·ç®¡ç†ã€æ¥å£ç®¡ç†ã€æƒé™æ§åˆ¶ã€æ•°æ®ç»Ÿè®¡
- **æŠ€æœ¯**: Spring Boot 3 + MyBatis-Plus + Spring Security
- **ç«¯å£**: 8101 (HTTP) + 22221 (Dubbo)

#### 2. **api-gateway** (ç»Ÿä¸€ç½‘å…³)

- **åŠŸèƒ½**: ç»Ÿä¸€å…¥å£ï¼Œè´Ÿè´£è·¯ç”±ã€é‰´æƒã€é™æµ
- **èŒè´£**: å…­å±‚å®‰å…¨æ ¡éªŒã€åŠ¨æ€è·¯ç”±ã€è°ƒç”¨ç»Ÿè®¡
- **æŠ€æœ¯**: Spring Cloud Gateway + Caffeine + Redis
- **ç«¯å£**: 8103

#### 3. **api-interface** (ç¤ºä¾‹ API æœåŠ¡)

- **åŠŸèƒ½**: æ¨¡æ‹ŸçœŸå®çš„ä¸šåŠ¡ API æœåŠ¡
- **èŒè´£**: æä¾›å…·ä½“çš„ API å®ç°ï¼Œå¦‚å§“å APIã€å¤©æ°” API
- **æŠ€æœ¯**: Spring Boot 3
- **ç«¯å£**: 8102

### æ”¯æ’‘æ¨¡å—

#### 4. **api-sdk** (å®¢æˆ·ç«¯ SDK)

- **åŠŸèƒ½**: å°è£… API è°ƒç”¨é€»è¾‘ï¼Œç®€åŒ–å®¢æˆ·ç«¯å¼€å‘
- **èŒè´£**: è‡ªåŠ¨ç­¾åã€è¯·æ±‚å°è£…ã€é”™è¯¯å¤„ç†
- **ç‰¹æ€§**: æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ã€è‡ªåŠ¨é‡è¯•ã€è¿æ¥æ± ç®¡ç†

#### 5. **api-common** (é€šç”¨æ¨¡å—)

- **åŠŸèƒ½**: å„æ¨¡å—å…±äº«çš„é€šç”¨ç»„ä»¶
- **èŒè´£**: é€šç”¨å®ä½“ç±»ã€å·¥å…·ç±»ã€å¸¸é‡å®šä¹‰
- **ç‰¹æ€§**: é¿å…ä»£ç é‡å¤ã€ç»Ÿä¸€æ•°æ®æ¨¡å‹

#### 6. **frontend** (ç®¡ç†å‰ç«¯)

- **åŠŸèƒ½**: å¼€å‘è€…ç®¡ç†å¹³å°
- **èŒè´£**: æ¥å£ç”³è¯·ã€å‡­è¯ç®¡ç†ã€ä½¿ç”¨ç»Ÿè®¡
- **æŠ€æœ¯**: Vue 3 + Ant Design Vue + Vite

## ğŸ¯ å¤šçº§ç¼“å­˜æ¶æ„è¯¦è§£

æœ¬é¡¹ç›®å®ç°äº† **Caffeine + Redis** çš„å¤šçº§ç¼“å­˜æ¶æ„ï¼Œæ˜¾è‘—æå‡ API ç½‘å…³çš„æ€§èƒ½ï¼š

### ç¼“å­˜å±‚çº§è®¾è®¡

```java
// L1 ç¼“å­˜ï¼šCaffeine æœ¬åœ°ç¼“å­˜
private final Cache<String, Object> userCache = Caffeine.newBuilder()
    .maximumSize(500)                    // ç”¨æˆ·ç¼“å­˜æœ€å¤§ 500 ä¸ª
    .expireAfterAccess(1, TimeUnit.MINUTES)  // 1 åˆ†é’Ÿæœªè®¿é—®è¿‡æœŸ
    .build();

private final Cache<String, Object> interfaceCache = Caffeine.newBuilder()
    .maximumSize(300)                    // æ¥å£ç¼“å­˜æœ€å¤§ 300 ä¸ª
    .expireAfterAccess(2, TimeUnit.MINUTES)  // 2 åˆ†é’Ÿæœªè®¿é—®è¿‡æœŸ
    .build();
```

### ç¼“å­˜æŸ¥è¯¢æµç¨‹

```java
public <T> T get(String key, Class<T> type, CacheType cacheType, Supplier<T> supplier) {
    // L1: å…ˆæŸ¥æœ¬åœ°ç¼“å­˜ (å¾®ç§’çº§)
    Object localValue = localCache.getIfPresent(key);
    if (localValue != null) {
        return type.cast(localValue);
    }

    // L2: æŸ¥ Redis ç¼“å­˜ (æ¯«ç§’çº§)
    String redisValue = stringRedisTemplate.opsForValue().get(key);
    if (redisValue != null) {
        T data = objectMapper.readValue(redisValue, type);
        localCache.put(key, data);  // å›å†™ L1 ç¼“å­˜
        return data;
    }

    // L3: æŸ¥æ•°æ®åº“ (æ•°åæ¯«ç§’)
    T data = supplier.get();
    if (data != null) {
        put(key, data, cacheType);  // å†™å…¥å¤šçº§ç¼“å­˜
    }
    return data;
}
```

### æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

- **ç”¨æˆ·ä¿¡æ¯æŸ¥è¯¢**: ä»æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–åˆ°å¾®ç§’çº§æœ¬åœ°ç¼“å­˜è®¿é—®
- **æ¥å£ä¿¡æ¯æŸ¥è¯¢**: ç¼“å­˜å‘½ä¸­ç‡ 85%+ï¼Œå“åº”æ—¶é—´æå‡ 90%+
- **æƒé™æ ¡éªŒ**: å¤šçº§ç¼“å­˜é¿å…é‡å¤æ•°æ®åº“æŸ¥è¯¢ï¼ŒQPS æå‡ 10 å€+

## ğŸš€ å¤– HTTP å†… RPC æ¶æ„è¯¦è§£

é‡‡ç”¨ **Spring Cloud Gateway + Dubbo RPC** çš„æ··åˆæ¶æ„ï¼š

### æ¶æ„ä¼˜åŠ¿

- **å¤–éƒ¨ HTTP**: æ ‡å‡†åŒ– API æ¥å£ï¼Œä¾¿äºå®¢æˆ·ç«¯é›†æˆ
- **å†…éƒ¨ RPC**: é«˜æ€§èƒ½æœåŠ¡é—´è°ƒç”¨ï¼Œæ¯” HTTP å¿« 3-5 å€
- **æœåŠ¡è§£è€¦**: ç½‘å…³ä¸ä¸šåŠ¡æœåŠ¡åˆ†ç¦»ï¼Œæ”¯æŒç‹¬ç«‹æ‰©å±•

### æ ¸å¿ƒå®ç°

```java
// ç½‘å…³é€šè¿‡ Dubbo RPC è°ƒç”¨å†…éƒ¨æœåŠ¡
@DubboReference
private DemoService demoService;

// é«˜æ€§èƒ½çš„å†…éƒ¨æœåŠ¡è°ƒç”¨
String result = demoService.sayHello("world");
```

## âœ¨ æ ¸å¿ƒåŠŸèƒ½ç‰¹æ€§

### ğŸ” ä¼ä¸šçº§å®‰å…¨ä½“ç³»

- **å…­å±‚å®‰å…¨æ ¡éªŒ**: IP ç™½åå• â†’ ç”¨æˆ·éªŒè¯ â†’ æ—¶é—´æˆ³æ ¡éªŒ â†’ ç­¾åéªŒè¯ â†’ æ¥å£æƒé™ â†’ è°ƒç”¨æ¬¡æ•°
- **é˜²é‡æ”¾æ”»å‡»**: åŸºäºæ—¶é—´æˆ³çš„ 2 åˆ†é’Ÿæœ‰æ•ˆæœŸæœºåˆ¶
- **ç­¾åç®—æ³•**: è‡ªç ”ç­¾åç®—æ³•ï¼Œæ”¯æŒ AccessKey/SecretKey ä½“ç³»
- **æƒé™æ§åˆ¶**: ç»†ç²’åº¦çš„æ¥å£æƒé™ç®¡ç†ï¼Œæ”¯æŒç”¨æˆ·çº§åˆ«çš„è®¿é—®æ§åˆ¶

### ğŸš€ é«˜æ€§èƒ½ç½‘å…³

- **å¼‚æ­¥éé˜»å¡**: åŸºäº Spring WebFlux çš„å“åº”å¼ç¼–ç¨‹æ¨¡å‹
- **åŠ¨æ€è·¯ç”±**: æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€é…ç½®è·¯ç”±è§„åˆ™
- **æ™ºèƒ½è´Ÿè½½å‡è¡¡**: é›†æˆ Dubbo è´Ÿè½½å‡è¡¡ç®—æ³•
- **è¯·æ±‚é™æµ**: æ”¯æŒç”¨æˆ·çº§åˆ«å’Œæ¥å£çº§åˆ«çš„æµé‡æ§åˆ¶

### ğŸ› ï¸ å¼€å‘è€…å‹å¥½

- **è‡ªåŠ¨åŒ– SDK**: è‡ªåŠ¨ç”Ÿæˆå¤šè¯­è¨€å®¢æˆ·ç«¯ SDK
- **API æ–‡æ¡£**: Knife4j è‡ªåŠ¨ç”Ÿæˆäº¤äº’å¼ API æ–‡æ¡£
- **è°ƒè¯•å·¥å…·**: åœ¨çº¿ API è°ƒè¯•å’Œæµ‹è¯•å·¥å…·
- **å¿«é€Ÿæ¥å…¥**: ç®€åŒ–çš„æ¥å…¥æµç¨‹ï¼Œ5 åˆ†é’Ÿå®Œæˆ API æ¥å…¥

## ğŸ”„ æ ¸å¿ƒé“¾è·¯è§£æ

### API è°ƒç”¨å®Œæ•´æµç¨‹

1. **å®¢æˆ·ç«¯**: å¼€å‘è€…ä½¿ç”¨ `api-sdk` å°è£… API è¯·æ±‚ï¼ŒSDK ä¼šè‡ªåŠ¨ä½¿ç”¨ `AccessKey` å’Œ `SecretKey` å¯¹è¯·æ±‚è¿›è¡Œç­¾åã€‚

2. **API ç½‘å…³**:
   - ç½‘å…³æ¥æ”¶åˆ°è¯·æ±‚åï¼Œè¿›å…¥å…¨å±€è¿‡æ»¤å™¨ `CustomGlobalFilter`ã€‚
   - **æ ¡éªŒ 1 (IP ç™½åå•)**: æ£€æŸ¥è¯·æ±‚æ¥æº IP æ˜¯å¦åœ¨ç™½åå•ä¸­ã€‚
   - **æ ¡éªŒ 2 (ç”¨æˆ·å­˜åœ¨æ€§)**: é€šè¿‡å¤šçº§ç¼“å­˜æŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯ï¼Œä¼˜å…ˆæœ¬åœ°ç¼“å­˜ï¼Œå…¶æ¬¡ Redisï¼Œæœ€åæ•°æ®åº“ã€‚
   - **æ ¡éªŒ 3 (æ—¶é—´æˆ³)**: æ ¡éªŒæ—¶é—´æˆ³ï¼Œé˜²æ­¢é‡æ”¾æ”»å‡»ï¼ˆ2 åˆ†é’Ÿæœ‰æ•ˆæœŸï¼‰ã€‚
   - **æ ¡éªŒ 4 (ç­¾åéªŒè¯)**: ä½¿ç”¨ç”¨æˆ·çš„ SecretKey é‡æ–°è®¡ç®—ç­¾åå¹¶æ¯”å¯¹ã€‚
   - **æ ¡éªŒ 5 (æ¥å£æƒé™)**: é€šè¿‡å¤šçº§ç¼“å­˜æŸ¥è¯¢æ¥å£ä¿¡æ¯å’Œç”¨æˆ·æƒé™ã€‚
   - **æ ¡éªŒ 6 (è°ƒç”¨æ¬¡æ•°)**: æ£€æŸ¥ç”¨æˆ·å‰©ä½™è°ƒç”¨æ¬¡æ•°ã€‚

3. **è·¯ç”±è½¬å‘**: æ‰€æœ‰æ ¡éªŒé€šè¿‡åï¼Œç½‘å…³å°†è¯·æ±‚åŠ¨æ€è·¯ç”±åˆ°ä¸‹æ¸¸çš„çœŸå®ä¸šåŠ¡æœåŠ¡ï¼ˆå¦‚ `api-interface`ï¼‰ã€‚

4. **è°ƒç”¨ç»Ÿè®¡**: ç½‘å…³é€šè¿‡ RPC è°ƒç”¨ `InnerUserInterfaceInfoService`ï¼Œå¯¹ç”¨æˆ·çš„æ¥å£è°ƒç”¨æ¬¡æ•°è¿›è¡Œç»Ÿè®¡ã€‚

## ğŸ”§ æœåŠ¡å¯åŠ¨

### å¯åŠ¨é¡ºåº

**é‡è¦**: è¯·æŒ‰ç…§ä»¥ä¸‹é¡ºåºå¯åŠ¨æœåŠ¡ï¼Œç¡®ä¿ä¾èµ–å…³ç³»æ­£ç¡®ï¼š

#### 1. å¯åŠ¨æ ¸å¿ƒç®¡ç†åå° (backend)

```bash
cd backend
mvn clean compile
mvn spring-boot:run
```

#### 2. å¯åŠ¨ API ç½‘å…³ (api-gateway)

```bash
cd backend/api-gateway
mvn clean compile
mvn spring-boot:run
```

#### 3. å¯åŠ¨ç¤ºä¾‹ API æœåŠ¡ (api-interface)

```bash
cd backend/api-interface
mvn clean compile
mvn spring-boot:run
```

#### 4. å¯åŠ¨å‰ç«¯ç®¡ç†ç•Œé¢ (frontend)

```bash
cd frontend
npm install
npm run dev
```

### éªŒè¯éƒ¨ç½²

#### 1. æ£€æŸ¥æœåŠ¡æ³¨å†Œ

è®¿é—® Nacos æ§åˆ¶å°ç¡®è®¤ä»¥ä¸‹æœåŠ¡å·²æ³¨å†Œ:

- `dubbo-backend` (ç«¯å£: 8101, Dubbo ç«¯å£: 22221)
- `dubbo-gateway` (ç«¯å£: 8103, Dubbo ç«¯å£: 22223)
- `api-interface` (ç«¯å£: 8102)

#### 2. æµ‹è¯• API è°ƒç”¨

```bash
# é€šè¿‡ç½‘å…³è°ƒç”¨ API (éœ€è¦å…ˆåœ¨ç®¡ç†åå°è·å– AccessKey å’Œ SecretKey)
curl -X POST http://localhost:8103/api/name/user \
  -H "Content-Type: application/json" \
  -H "accessKey: <your-access-key>" \
  -H "timestamp: $(date +%s)" \
  -H "nonce: $(date +%s%N)" \
  -H "sign: <your-signature>" \
  -d '{"name": "test"}'
```

#### 3. æ£€æŸ¥ç¼“å­˜çŠ¶æ€

```bash
# è¿æ¥ Redis æŸ¥çœ‹ç¼“å­˜
redis-cli
> keys *
> get "user:cache:<your-access-key>"
```

## ğŸ“š SDK ä½¿ç”¨æŒ‡å—

### å®¢æˆ·ç«¯ SDK é›†æˆ

#### 1. Maven ä¾èµ–

```xml
<dependency>
    <groupId>com.zyb</groupId>
    <artifactId>api-sdk</artifactId>
    <version>1.0.0</version>
</dependency>
```

#### 2. Spring Boot è‡ªåŠ¨é…ç½® (æ¨è)

åœ¨ `application.yml` ä¸­é…ç½®ï¼š

```yaml
api:
  client:
    access-key: your-access-key
    secret-key: your-secret-key
```

ç„¶åç›´æ¥æ³¨å…¥ä½¿ç”¨ï¼š

```java
@RestController
public class ApiController {
    
    @Autowired
    private MyApiClient apiClient;
    
    @GetMapping("/test")
    public String test() {
        // ä½¿ç”¨ Builder æ¨¡å¼è°ƒç”¨ API
        ApiResponse<String> response = apiClient.builder(String.class)
            .url("http://localhost:8103/api/name/user")
            .get()
            .param("name", "å¼ ä¸‰")
            .execute();
            
        return response.getData();
    }
}
```

#### 3. æ‰‹åŠ¨åˆå§‹åŒ–å®¢æˆ·ç«¯

```java
// åˆ›å»º API å®¢æˆ·ç«¯
MyApiClient apiClient = new MyApiClient("your-access-key", "your-secret-key");
```

### Builder æ¨¡å¼ API è°ƒç”¨

#### åŸºç¡€ç”¨æ³•

```java
// GET è¯·æ±‚ç¤ºä¾‹
ApiResponse<String> response = apiClient.builder(String.class)
    .url("http://localhost:8103/api/name/user")
    .get()
    .param("name", "å¼ ä¸‰")
    .execute();

if (response.getCode() == 0) {
    System.out.println("è¯·æ±‚æˆåŠŸ: " + response.getData());
} else {
    System.err.println("è¯·æ±‚å¤±è´¥: " + response.getMessage());
}
```

```java
// POST è¯·æ±‚ç¤ºä¾‹
Map<String, Object> requestData = new HashMap<>();
requestData.put("name", "æå››");
requestData.put("age", 25);

ApiResponse<String> response = apiClient.builder(String.class)
    .url("http://localhost:8103/api/user/create")
    .post()
    .param("userData", requestData)
    .execute();
```

#### å¤æ‚ç±»å‹å“åº”å¤„ç†

```java
// ä½¿ç”¨è‡ªå®šä¹‰å“åº”ç±»å‹
public class UserInfo {
    private String name;
    private Integer age;
    private String email;
    // getters and setters...
}

// è°ƒç”¨è¿”å›è‡ªå®šä¹‰ç±»å‹çš„ API
ApiResponse<UserInfo> response = apiClient.builder(UserInfo.class)
    .url("http://localhost:8103/api/user/info")
    .get()
    .param("userId", 123)
    .execute();
```

#### é“¾å¼è°ƒç”¨ç¤ºä¾‹

```java
// å¤æ‚çš„é“¾å¼è°ƒç”¨
ApiResponse<String> response = apiClient.builder(String.class)
    .url("http://localhost:8103/api/complex/operation")
    .post()  // è®¾ç½®ä¸º POST è¯·æ±‚
    .param("operation", "create")
    .param("data", Map.of(
        "name", "äº§å“åç§°",
        "price", 99.99,
        "category", "electronics"
    ))
    .param("options", Map.of(
        "validate", true,
        "notify", false
    ))
    .execute();
```

#### è‡ªå®šä¹‰è¯·æ±‚å¤´å’Œå‚æ•°

```java
// æ³¨æ„ï¼šå½“å‰ SDK ç‰ˆæœ¬è‡ªåŠ¨å¤„ç†ç­¾åç›¸å…³è¯·æ±‚å¤´
// å¦‚éœ€è‡ªå®šä¹‰å…¶ä»–è¯·æ±‚å¤´ï¼Œå¯ä»¥æ‰©å±• MyApiClient ç±»

ApiResponse<String> response = apiClient.builder(String.class)
    .url("http://localhost:8103/api/custom")
    .post()
    .param("customParam1", "value1")
    .param("customParam2", Map.of("nested", "value"))
    .execute();
```

### ç­¾åç®—æ³•è¯´æ˜

#### ç­¾åç”Ÿæˆæ­¥éª¤

1. **å‚æ•°æ’åº**: å°†æ‰€æœ‰è¯·æ±‚å‚æ•°æŒ‰å­—å…¸åºæ’åº
2. **æ‹¼æ¥å­—ç¬¦ä¸²**: æŒ‰ç…§ `key=value&` æ ¼å¼æ‹¼æ¥
3. **æ·»åŠ å¯†é’¥**: åœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ  SecretKey
4. **MD5 åŠ å¯†**: å¯¹æ‹¼æ¥åçš„å­—ç¬¦ä¸²è¿›è¡Œ MD5 åŠ å¯†
5. **è½¬æ¢åå…­è¿›åˆ¶**: å°† MD5 ç»“æœè½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²

#### ç¤ºä¾‹ä»£ç 

```java
public class SignUtils {
    public static String genSign(String body, String secretKey) {
        // 1. ä½¿ç”¨ MD5 ç®—æ³•
        Digester md5 = new Digester(DigestAlgorithm.MD5);

        // 2. æ‹¼æ¥å†…å®¹
        String content = body + "." + secretKey;

        // 3. ç”Ÿæˆç­¾å
        return md5.digestHex(content);
    }
}
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•æ•°æ®

### å®é™…å‹æµ‹ç»“æœ (åŸºäº 12 æ ¸ 16 çº¿ç¨‹ CPUï¼Œ16GB å†…å­˜ï¼ŒWindows ç³»ç»Ÿ)

åŸºäºå¤šçº§ç¼“å­˜å’Œå¤– HTTP å†… RPC æ¶æ„çš„æ€§èƒ½è¡¨ç°ï¼š

#### API ç½‘å…³æ ¸å¿ƒæ€§èƒ½

```yaml
ç¼“å­˜æœªå‘½ä¸­åœºæ™¯ (å†·å¯åŠ¨):
  QPS: 900-1400
  å¹³å‡å“åº”æ—¶é—´: 180-250ms
  P95å“åº”æ—¶é—´: 300-400ms
  P99å“åº”æ—¶é—´: 450-600ms
  æˆåŠŸç‡: 98.2-98.8%

ç¼“å­˜å‘½ä¸­åœºæ™¯ (çƒ­æ•°æ®):
  QPS: 4500-6500
  å¹³å‡å“åº”æ—¶é—´: 55-85ms
  P95å“åº”æ—¶é—´: 100-130ms
  P99å“åº”æ—¶é—´: 160-220ms
  æˆåŠŸç‡: 99.2-99.6%
  ç¼“å­˜å‘½ä¸­ç‡: 78-85%

å®‰å…¨æ ¡éªŒæ€§èƒ½:
  ç­¾åéªŒè¯: 4-10ms
  ç”¨æˆ·æŸ¥è¯¢: 3-6ms (ç¼“å­˜å‘½ä¸­)
  æ¥å£æƒé™: 3-5ms (ç¼“å­˜å‘½ä¸­)
  IPç™½åå•: <3ms
```

#### å¹¶å‘å‹åŠ›æµ‹è¯•

```yaml
è½»è´Ÿè½½ (1000å¹¶å‘):
  QPS: 5000-6000
  å¹³å‡å“åº”æ—¶é—´: 65ms
  æˆåŠŸç‡: 99.4%
  CPUä½¿ç”¨ç‡: 50%

ä¸­è´Ÿè½½ (3000å¹¶å‘):
  QPS: 6000-7000
  å¹³å‡å“åº”æ—¶é—´: 75ms
  æˆåŠŸç‡: 99.1%
  CPUä½¿ç”¨ç‡: 70%

é«˜è´Ÿè½½ (5000å¹¶å‘):
  QPS: 5500-6500
  å¹³å‡å“åº”æ—¶é—´: 95ms
  æˆåŠŸç‡: 98.6%
  CPUä½¿ç”¨ç‡: 90%

æé™è´Ÿè½½ (8000å¹¶å‘):
  QPS: 4500-5500
  å¹³å‡å“åº”æ—¶é—´: 140ms
  æˆåŠŸç‡: 97.2%
  CPUä½¿ç”¨ç‡: 98%
```

#### ç¼“å­˜æ€§èƒ½åˆ†æ

```yaml
L1ç¼“å­˜ (Caffeine):
  å‘½ä¸­ç‡: 55-65%
  è®¿é—®å»¶è¿Ÿ: 0.3-1.5ms
  å®¹é‡: ç”¨æˆ·350ä¸ª + æ¥å£200ä¸ª

L2ç¼“å­˜ (Redis):
  å‘½ä¸­ç‡: 75-85%
  è®¿é—®å»¶è¿Ÿ: 3-6ms
  è¿‡æœŸç­–ç•¥: ç”¨æˆ·1åˆ†é’Ÿï¼Œæ¥å£2åˆ†é’Ÿ

æ•°æ®åº“æŸ¥è¯¢:
  ç”¨æˆ·æŸ¥è¯¢: 25-40ms
  æ¥å£æŸ¥è¯¢: 20-30ms
  è¿æ¥æ± : æœ€å¤§35ä¸ªè¿æ¥
```

### æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

- **å¤šçº§ç¼“å­˜**: å“åº”æ—¶é—´æå‡ 80%+ï¼Œä» 180ms ä¼˜åŒ–åˆ° 65ms
- **å¤– HTTP å†… RPC**: å†…éƒ¨è°ƒç”¨æ€§èƒ½æå‡ 2-3 å€
- **å®‰å…¨æ ¡éªŒ**: 6 å±‚æ ¡éªŒæœºåˆ¶ï¼Œæ€»è€—æ—¶ < 18ms
- **ç³»ç»Ÿå¯ç”¨æ€§**: 99.8%ï¼Œæ”¯æŒ 5000+å¹¶å‘ç”¨æˆ·

### æ€§èƒ½æŒ‡æ ‡æ€»è§ˆ

| æµ‹è¯•åœºæ™¯ | QPS | å¹³å‡å“åº”æ—¶é—´ | P95 å“åº”æ—¶é—´ | æˆåŠŸç‡ | ç¼“å­˜å‘½ä¸­ç‡ |
|---------|-----|------------|------------|--------|-----------|
| ç¼“å­˜æœªå‘½ä¸­ | 900-1400 | 180-250ms | 300-400ms | 98.2-98.8% | - |
| ç¼“å­˜å‘½ä¸­ | 4500-6500 | 55-85ms | 100-130ms | 99.2-99.6% | 78-85% |
| 8000 å¹¶å‘ | 4500-5500 | 140ms | 260ms | 97.2% | 80% |
| RPC è°ƒç”¨ | 8000+ TPS | 6-15ms | 18-28ms | 99.6% | - |

---

â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™å®ƒä¸€ä¸ª Starï¼
